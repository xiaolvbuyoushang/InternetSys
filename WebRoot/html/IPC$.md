# IPC$(Internet Process Connection)

---

## IPC$ 的概念

IPC`$`(Internet Process Connection) 是共享 "命名管道" 的资源，它是为了让进程间通信而开放的命名管道，可以通过验证用户名和密码获得相应的权限, 在远程管理计算机和查看计算机的共享资源时使用。

利用 IPC`$`，连接者可以与目标主机建立一个连接，利用这个连接，连接者可以得到目标主机上的目录结构、用户列表等信息。(当然, 对方机器必须开了 IPC$ 共享, 否则你是连接不上的)。

---

## IPC$ 与空连接、139、445、默认共享的关系

**IPC$ 与空连接**

不需要用户名与密码的 IPC`$` 连接即为空连接, 一旦你以某个用户或管理员的身份登录 (即以特定的用户名和密码进行 IPC`$` 连接), 自然就不能叫做空连接了.

当你以空连接登录时, 你没有任何权限, 而你以用户或管理员的身份登录时, 你就会有相应的权限.

**IPC$ 与 139,445 端口**

IPC`$` 连接可以实现远程登录及对默认共享的访问; 而 139 端口的开启表示 netbios 协议的应用, 我们可以通过 139,445(win2000) 端口实现对共享文件/打印机的访问, 因此一般来讲, IPC$ 连接是需要 139 或 445 端口来支持的.

注：IPC`$` 连接默认会去走 445 端口，不通的话则会走 139 端口，这两个端口都可以单独实现文件共享

**IPC$ 与默认共享**

默认共享是为了方便管理员远程管理而默认开启的共享 (你当然可以关闭它), 即所有的逻辑盘(c`$`,d`$`,e`$`……) 和系统目录 winnt 或 windows(admin`$`), 我们通过 IPC`$` 连接可以实现对这些默认共享的访问(前提是对方没有关闭这些默认共享)

可以本地输入 `net share` 查看共享的逻辑盘

---

## 建立远程连接时的用户权限问题

即默认情况下只有域管用户有权限对 admin`$` 目录建立 IPC 连接，其实本地的 Administrator 用户也可以，但是默认情况下该用户是被禁用的，如果启用了该用户，那么也可以使用 Administrator 用户远程连接

---

## IPC$ 连接失败常见错误号

- 错误号 5，拒绝访问
    - 很可能你使用的用户不是管理员权限的，先提升权限
- 错误号 51，Windows 无法找到网络路径
    - 网络有问题
- 错误号 53，找不到网络路径
    - ip 地址错误；目标未开机；目标 lanmanserver 服务未启动；目标有防火墙（端口过滤）
- 错误号 67，找不到网络名
    - 你的 lanmanworkstation 服务未启动；目标删除了 ipc$；
- 错误号 1219，提供的凭据与已存在的凭据集冲突
    - 你已经和对方建立了一个 ipc$，请删除后再连
- 错误号 1326，未知的用户名或错误密码
- 错误号 1385，登录失败：未授予用户在此计算机上的请求登录类型
    - 情况 1：可能是你在 “拒绝从网络访问这台计算机” 功能中拒绝了该用户的访问，解决方法如下：开始 -->运行 -->gpedit.msc 计算机配置 -->Windows 设置 -->安全设置 -->本地策略 -->用户权利指派 -->拒绝从网络访问这台计算机 -->删除你要正常连接的用户
    - 情况 2：
        - (1)网络访问为：经典
        - (2)来宾账户状态：已启用，
        - (3)拒绝从网络访问这台计算机里有 Guest 用户或组
        - (4)你执行 net use \\xxx.xxx.xxx.xxx\IPC`$` "123456" /user:"xxx" 输入的用户名是随便输入的，这时也会遇到这个错误信息，因为当你连接的用户不存在时，net use 会默认用 Guest 用户来进行连接，而 Guest 用户已拒绝从网络访问，所以也会出现这种错误
- 错误号 1792，试图登录，但是网络登录服务没有启动
    - 目标 NetLogon 服务未启动[连接域控会出现此情况]
- 错误号 2242，此用户的密码已经过期
    - 目标有帐号策略，强制定期要求更改密码
